# 開發紀錄

### MCU開發板(NuMaker-PFM-M487)
+ 官方網站介紹: https://www.nuvoton.com/products/iot-solution/iot-platform/numaker-pfm-m487/index.html
+ 官方資源:
  + 線路圖: 可在官方介紹網頁中找到，已備份在「 https://github.com/cgrgncu/ADS1256_NCU_V0_9C/tree/main/NuMaker-PFM-M487/官方資源/參考線路 」。
  + 使用者手冊: 可在官方介紹網頁中找到，已備份在「 https://github.com/cgrgncu/ADS1256_NCU_V0_9C/tree/main/NuMaker-PFM-M487/官方資源/使用者手冊 」。
  + 範例程式碼 Board Support Package (BSP): https://github.com/OpenNuvoton/M480BSP ， 下載頁面: https://github.com/OpenNuvoton/M480BSP/releases 。

### 讀使用者手冊
+ 使用｢Nu-Link-Me ICE Bridge｣來燒錄韌體到MCU(M487)中。
+ 5V電源供應:
  + ICEJ、CON1、CON2、NU1(pin5)

### Nu-Link(價格與特色以後再查)
+ Nu-Link-Pro
+ Nu-Link
+ Nu-Link-Me

### 開發環境
+ 官方整理清單: https://www.nuvoton.com/tool-and-software/ide-and-compiler/
+ 相關驅動可以在該頁面下載。

  | IDE                            | Validated MCUs    | License       | Debugger                      | Windows            | Linux              |
  |--------------------------------|-------------------|---------------|-------------------------------|--------------------|--------------------|
  | NuEclipse (GCC)                | NuMicro M0/M4/M23 | Free          | Nu-Link                       | :heavy_check_mark: | :heavy_check_mark: |
  | KEIL MDK Nuvoton edition M4/M7 | NuMicro M4/M7     | Special offer | Nu-Link / J-Link / U-Link     | :heavy_check_mark: |                    |
  | IAR EWARM                      | NuMicro M0/M4/M23 | IAR           | Nu-Link                       | :heavy_check_mark: | :heavy_check_mark: |

### 開發環境IAR EWARM
+ 付費軟體，但是有免費評估版。官方聲稱不可以用免費評估版進行產品開發。


### 開發環境Keil
+ 付費軟體，但是有出Nuvoton版，可商用。

---

## IAR開發紀錄
+ 沒有安裝驅動的情況下接上ICE到電腦USB，win7有找到Nu-Link裝置但無法自動搜尋到驅動。

### 安裝
+ 作業系統: Windows 7 64 bit 
+ IAR版本: IAR 8.30.1
> 安裝筆記:
> + 在Win7下，一定要勾選「Dongle Driver」才會順便安裝需要的VC++散發套件。「Debug probe drivers」的驅動太舊了全部不要勾選，請另外自行安裝需要的驅動。
> + 安裝完畢後，再去新增移除程式的地方移除「Dongle Driver」(Sentinel System Driver Installer 7.6.0)。
> + 要自行安裝Nuvoton官方提供的Nu-Link_IAR_Driver(在 https://www.nuvoton.com/tool-and-software/ide-and-compiler/ 中)。這樣才能取得最新的晶片清單及正確驅動。

### 範例程式碼 Board Support Package (BSP)
+ https://github.com/OpenNuvoton/M480BSP 
+ https://github.com/OpenNuvoton/M480BSP/releases 。
+ 選用版本: M480BSP-3.05.001
+ 通常Nu-Link2-Me(ICE裝置)上有撥動開關，只有pin#1#2有用，切到ON就會直接連接到MCU的UART0。
+ 建議所有開發都保留UART0當作DEBUG PORT。因為Nu-link-Me除了燒錄功能也等同是一個UARTtoVCOM的裝置。預設C語言的標準輸入輸出函數的printf、scanf等等會對應UART0，讓開發者覺得很親切。
+ DEBUG以外使用的UART還是建議用UART函數來實作輸入輸出功能。
 
### Hello world! 
+ 位置在:「\M480BSP-3.05.001\SampleCode\Template」。 先試圖編譯並燒錄到開發版上。
+ 用putty開啟Serial port(Virtual COM port裝置，名稱從裝置管理員找)，使用115200–8-N-1的配置。基本上PC端只要設定速度為115200即可。
+ 正確連接後，按下RESET按鈕(開發版上排列沒有對齊的那個按鈕)，即可看到「Hello World!」文字。
+ putty若要看的到中文，請設定「Window」>「Translation」>「Use font encoding」。部分版本這個就是預設值，但有些版本預設是UTF-8。

### LED 燈號控制
+ 找不到範例Code，可能要抓其他的參考: 
  + https://www.youtube.com/watch?v=5lDU01nPIn0
  + https://github.com/OpenNuvoton/M031BSP/tree/master/SampleCode/Level1_Training/Level1_GPIO_Ctrl
+ 為了容易管理，建議複製一份「\M480BSP-3.05.001\SampleCode\Template」到指定的資料夾中來開發。例如:位置在:「\M480BSP-3.05.001\SampleCode\LED_example」。
+ 接著把「\M480BSP-3.05.001\SampleCode\LED_example\GCC」、「\M480BSP-3.05.001\SampleCode\LED_example\Keil」資料夾都刪除。
+ 再把「\M480BSP-3.05.001\SampleCode\LED_example\IAR」資料夾中的「Template.ewd」、「Template.ewp」、「Template.eww」分別改為「LED_example.ewd」、「LED_example.ewp」、「LED_example.eww」。
+ 再將「Template.ewd」、「Template.ewp」、「Template.eww」用文字編輯器打開，把所有「Template」文字取代成「LED_example」。
+ 接著點兩下「LED_example.eww」即可用IAR打開專案了。

---
### GPS
+ ublox是瑞士公司。
+ 目前規劃UART與VCOM的鮑率為57600。
+ 使用ublox-NEO-M8T模組。產品分類為Timing類型。
+ 支援的全球導航系統（Global Navigation Satellite System, GNSS）:
  + 美國全球定位系統（Global Positioning System, GPS）
  + 俄國的格洛納斯系統（Globalnaya Navigatsionnaya Sputnikovaya Sistema, GLONASS）
  + 中國北斗衛星導航系統（BeiDou Navigation Satellite System, BDS）
  + 歐盟的伽利略定位系統（Galileo）
+ 支援的介面:
  + USB
  + UART
  + SPI
  + DDC (I2C-compatible)
+ Timepulse: 2個，0.25~10M Hz
+ RTC與備援電源: 維持時間與重要資訊(當前設定參數、最近的星曆表、位置和輔助數據)。
+ 若有必要，可使用外部GPIO來開關電源(Pin#144,PB.8,GPS_ONn)。
+ 規劃的標準輸出(NMEA standard):
  + $GNRMC,,V,,,,,,,,,,N*4D， GN=多個系統解出來的，RMC=建議最小定位訊息。基本上用這個就夠了有時間位置等最主要資訊。
  + $GNVTG,,,,,,,,,N*2E， VTG=地面速度信息。我用不到
  + $GNGGA,,,,,,0,00,99.99,,,,,,*56，GGA=定位訊息。這個有衛星資訊，但是沒有日期...。
  + $GNGSA,A,1,,,,,,,,,,,,,99.99,99.99,99.99*2E，GSA=目前衛星資訊。用不到。
  + $GNGSA,A,1,,,,,,,,,,,,,99.99,99.99,99.99*2E，GSA=目前衛星資訊。用不到。
  + $GPGSV,1,1,00*79，GSV=可見衛星資訊。用不到。
  + $GLGSV,1,1,00*65，GSV=可見衛星資訊。用不到。
  + $GNGLL,,,,,,V,N*7A，GLL=地理定位訊息。用不到
  + $GNZDA,,,,,00,00*56，ZDA=日期和時間訊息。有時區資訊，但ublox-NEO-M8T不能用永遠輸出00。
